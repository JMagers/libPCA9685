# post-install.txt style script for raspbian-ua-netinst

echo ""
echo "=== Adding libPCA9685 ==="

# activate i2c
chroot /rootfs echo "dtparam=i2c_arm=on" >> /boot/config.txt
chroot /rootfs echo "dtparam=i2c_arm_baudrate=1000000" >> /boot/config.txt
chroot /rootfs echo "options i2c_bcm2708 combined=1" >> /etc/modprobe.d/i2c_repeated_start.conf
chroot /rootfs echo "i2c-dev" >> /etc/modules

# install make
echo ""
echo "= Adding make"
chroot /rootfs /usr/bin/apt-get -y --no-install-recommends install make

# install cmake
echo ""
echo "= Adding cmake"
chroot /rootfs /usr/bin/apt-get -y --no-install-recommends install cmake

# install g++
echo ""
echo "= Adding g++"
chroot /rootfs /usr/bin/apt-get -y --no-install-recommends install g++

# download libPCA9685
echo ""
echo "= Cloning libPCA9685"
chroot /rootfs /usr/bin/git clone git://github.com/edlins/libPCA9685 /usr/local/src/libPCA9685

# build and install libPCA9685
chroot /rootfs /bin/sh <<'EOFlibPCA9685'
cd /usr/local/src/libPCA9685
echo ""
echo "= Building libPCA9685"
mkdir build && cd build
cmake ..
make
echo ""
echo "= Installing libPCA9685"
make install
EOFlibPCA9685

